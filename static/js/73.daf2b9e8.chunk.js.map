{"version":3,"sources":["pages/indices/index/DataEditTable.js","pages/indices/index/IndexedDataTable.js","pages/indices/index/Data.js"],"names":["useStyles","makeStyles","theme","backdrop","zIndex","drawer","color","tableIcons","Add","forwardRef","props","ref","Check","Clear","Delete","DetailPanel","Edit","Export","Filter","FirstPage","LastPage","NextPage","PreviousPage","ResetSearch","Search","SortArrow","ThirdStateCheck","ViewColumn","searchInterval","connect","store","indicesReducers","dsearchReducers","dispatch","index","authUser","mappings","documentSourceResponse","useSelector","useState","keyword","setKeyword","pageNum","setPageNum","rowSize","setRowSize","columns","setColumns","dataList","setDataList","selectData","setSelectData","process","setProcess","boxRef","useRef","fetchIndexDocumentSourceList","searchSize","setIndexMappingsAction","then","response","indexMapping","payload","setIndexDocumentSourceListAction","from","size","tmpColumns","Object","assign","forEach","hit","source","flat","keys","key","undefined","hits","map","flatHit","tmpData","column","replace","handleChangeRowsPerPage","row","handleSearch","clearTimeout","setTimeout","flatMappings","test","filter","c","includes","customSort","a","b","length","useEffect","Fragment","Box","style","width","height","display","top","justifyContent","alignItems","backgroundColor","opacity","position","CircularProgress","role","icons","title","localization","body","emptyDataSourceMessage","sort","field","editable","cellStyle","whiteSpace","maxWidth","overflow","data","onChangeRowsPerPage","onRowAdd","newData","Promise","resolve","reject","tmpBody","unflatten","addIndexDocumentSourceAction","catch","onRowUpdate","oldData","id","editIndexDocumentSourceAction","onRowDelete","deleteIndexDocumentSourceAction","onSearchChange","options","headerStyle","onRowClick","event","rowData","target","innerText","Card","CardContent","mt","Typography","variant","gutterBottom","rowSizeList","classes","keywordInput","setKeywordInput","setFrom","setSize","totalSize","setTotalSize","loading","setLoading","fetchDocuments","searchFrom","searchKeyword","searchColumns","documents","documentAnalyzerMap","flatSource","flatField","analyzer","push","text","tmpMap","k","endsWith","substring","replaceAll","values","o","analyzerDocumentSourceAction","tmpDataList","value","term","find","obj","join","error","console","log","handlePagination","handleChangeKeyword","Grid","container","item","xs","className","form","InputBase","input","placeholder","onChange","onKeyUp","keyCode","IconButton","iconButton","onClick","align","Button","disabled","component","m","isNaN","Math","ceil","FormControl","formControl","Select","labelId","num","MenuItem","TableContainer","Table","TableHead","TableRow","TableCell","TableBody","colSpan","dataIndex","err","Data","chk","setChk","handleRadioChange","e","RadioGroup","aria-label","name","defaultValue","FormControlLabel","checked","control","Radio","label"],"mappings":"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","file":"static/js/73.daf2b9e8.chunk.js","sourcesContent":["import React, {forwardRef, useEffect, useRef, useState} from \"react\";\r\nimport {connect, useSelector} from \"react-redux\";\r\nimport {Box, Card, CardContent, Typography, Backdrop } from \"@material-ui/core\";\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\nimport MaterialTable from 'material-table';\r\nimport AddBox from '@material-ui/icons/AddBox';\r\nimport ArrowDownward from '@material-ui/icons/ArrowDownward';\r\nimport Check from '@material-ui/icons/Check';\r\nimport ChevronLeft from '@material-ui/icons/ChevronLeft';\r\nimport ChevronRight from '@material-ui/icons/ChevronRight';\r\nimport Clear from '@material-ui/icons/Clear';\r\nimport DeleteOutline from '@material-ui/icons/DeleteOutline';\r\nimport Edit from '@material-ui/icons/Edit';\r\nimport FilterList from '@material-ui/icons/FilterList';\r\nimport FirstPage from '@material-ui/icons/FirstPage';\r\nimport LastPage from '@material-ui/icons/LastPage';\r\nimport Remove from '@material-ui/icons/Remove';\r\nimport SaveAlt from '@material-ui/icons/SaveAlt';\r\nimport Search from '@material-ui/icons/Search';\r\nimport ViewColumn from '@material-ui/icons/ViewColumn';\r\nimport {\r\n    addIndexDocumentSourceAction,\r\n    deleteIndexDocumentSourceAction,\r\n    editIndexDocumentSourceAction,\r\n    setIndexDocumentSourceListAction,\r\n    setIndexMappingsAction\r\n} from \"../../../redux/actions/indicesActions\";\r\nimport flat, {unflatten} from 'flat'\r\nimport { makeStyles } from '@material-ui/core/styles';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    backdrop: {\r\n        zIndex: theme.zIndex.drawer + 1,\r\n        color: '#fff',\r\n    },\r\n}));\r\n\r\nconst tableIcons = {\r\n    Add: forwardRef((props, ref) => <AddBox {...props} ref={ref}/>),\r\n    Check: forwardRef((props, ref) => <Check {...props} ref={ref}/>),\r\n    Clear: forwardRef((props, ref) => <Clear {...props} ref={ref}/>),\r\n    Delete: forwardRef((props, ref) => <DeleteOutline {...props} ref={ref}/>),\r\n    DetailPanel: forwardRef((props, ref) => <ChevronRight {...props} ref={ref}/>),\r\n    Edit: forwardRef((props, ref) => <Edit {...props} ref={ref}/>),\r\n    Export: forwardRef((props, ref) => <SaveAlt {...props} ref={ref}/>),\r\n    Filter: forwardRef((props, ref) => <FilterList {...props} ref={ref}/>),\r\n    FirstPage: forwardRef((props, ref) => <FirstPage {...props} ref={ref}/>),\r\n    LastPage: forwardRef((props, ref) => <LastPage {...props} ref={ref}/>),\r\n    NextPage: forwardRef((props, ref) => <ChevronRight {...props} ref={ref}/>),\r\n    PreviousPage: forwardRef((props, ref) => <ChevronLeft {...props} ref={ref}/>),\r\n    ResetSearch: forwardRef((props, ref) => <Clear {...props} ref={ref}/>),\r\n    Search: forwardRef((props, ref) => <Search {...props} ref={ref}/>),\r\n    SortArrow: forwardRef((props, ref) => <ArrowDownward {...props} ref={ref}/>),\r\n    ThirdStateCheck: forwardRef((props, ref) => <Remove {...props} ref={ref}/>),\r\n    ViewColumn: forwardRef((props, ref) => <ViewColumn {...props} ref={ref}/>)\r\n};\r\nlet searchInterval = null\r\nfunction DataEditTable({dispatch, index, authUser, mappings}) {\r\n    const classes = useStyles();\r\n    const documentSourceResponse = useSelector(store => ({ ...store.indicesReducers}))['documentSourceResponse']\r\n    const [keyword, setKeyword] = useState(\"\");\r\n    const [pageNum, setPageNum] = useState(0);\r\n    const [rowSize, setRowSize] = useState(5);\r\n    const [columns, setColumns] = useState([])\r\n    const [dataList, setDataList] = useState([])\r\n    const [selectData, setSelectData] = useState(\"\")\r\n    const [process, setProcess] = useState(false)\r\n    const boxRef = useRef(null);\r\n\r\n    // 인덱스 변경시 호출\r\n    useEffect(() => {\r\n        setDataList([])\r\n        setSelectData(\"\")\r\n        setKeyword(\"\")\r\n        setPageNum(0)\r\n        setRowSize(5)\r\n        if (index === \"\") {\r\n            return\r\n        }\r\n        fetchIndexDocumentSourceList({keyword})\r\n    }, [index]) // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n    useEffect(() => {\r\n        const response = documentSourceResponse;\r\n        if (!response || !response['hits']) {\r\n            return false\r\n        }\r\n\r\n        let tmpColumns = {};\r\n        tmpColumns['ID'] = null\r\n        // tmpColumns = Object.assign(tmpColumns, mappings['properties']);\r\n        response['hits']['hits'].forEach(hit => {\r\n            const source = flat(hit['_source'])\r\n            Object.keys(source).forEach(key => {\r\n                tmpColumns[key] = null\r\n            })\r\n        })\r\n\r\n        const columns = Object.keys(tmpColumns)\r\n        setColumns(columns)\r\n\r\n        setDataList(response['hits']['hits'].map(hit => {\r\n            const flatHit = flat(hit)\r\n            let tmpData = {}\r\n            columns.forEach(column => {\r\n                tmpData[column.replace(/\\./gi, \"___\")] = flatHit['_source.' + column] || \"\"\r\n            })\r\n            tmpData['ID'] = hit['_id']\r\n            tmpData['_hitsId'] = hit['_id']\r\n            return tmpData\r\n        }))\r\n    }, []) // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n    function fetchIndexDocumentSourceList({searchSize=100, columns=[], keyword=null}) {\r\n            return dispatch(setIndexMappingsAction(index)).then((response)=> {\r\n                let indexMapping = response.payload;\r\n                dispatch(setIndexDocumentSourceListAction({index, from: pageNum, size: searchSize||rowSize, columns, keyword})).then(response => {\r\n                // columns 적용\r\n                let tmpColumns = {};\r\n                // let tmpColumns = {}\r\n                tmpColumns['ID'] = null;\r\n                \r\n                tmpColumns = Object.assign(tmpColumns, indexMapping['properties']);\r\n                ((response['hits']||{})['hits']).forEach(hit => {\r\n                    const source = flat(hit['_source'])\r\n                    Object.keys(source).forEach(key => {\r\n                        tmpColumns[key] = null\r\n                    })\r\n                })\r\n    \r\n                if (keyword === undefined || keyword === null || keyword === '') {\r\n                    setColumns(Object.keys(tmpColumns))\r\n                }\r\n    \r\n                // setColumns(Object.keys(tmpColumns))\r\n                return {\r\n                    columns: Object.keys(tmpColumns),\r\n                    hits: response['hits']\r\n                }\r\n            }).then(payload => {\r\n                if(payload) {\r\n                    setDataList((payload['hits']||{})['hits'].map(hit => {\r\n                        const flatHit = flat(hit)\r\n                        let tmpData = {}\r\n                        payload['columns'].forEach(column => {\r\n                            tmpData[column.replace(/\\./gi, \"___\")] = flatHit['_source.' + column] || \"\"\r\n                        })\r\n                        tmpData['ID'] = hit['_id']\r\n                        tmpData['_hitsId'] = hit['_id']\r\n                        return tmpData\r\n                    }))\r\n                } else {\r\n                    setDataList([])\r\n                }\r\n                setProcess(false)\r\n            })})\r\n    }\r\n\r\n    function handleChangeRowsPerPage(row) {\r\n        setRowSize(row)\r\n        fetchIndexDocumentSourceList({keyword})\r\n    }\r\n\r\n    function handleSearch(keyword) {\r\n        setDataList([])\r\n\r\n        if (searchInterval !== null) {\r\n            clearTimeout(searchInterval)\r\n        }\r\n\r\n        searchInterval = setTimeout(() => {\r\n            setProcess(true)\r\n            setKeyword(keyword)\r\n            // setColumns(columns)\r\n            let searchColumns = []\r\n            const flatMappings = flat(mappings)\r\n            if (/[^0-9]/gi.test(keyword)) {\r\n                // 문자\r\n                searchColumns = columns.filter(c => ['text','keyword'].includes(flatMappings[`${c}.type`]))\r\n            } else {\r\n                searchColumns = columns\r\n            }\r\n            // 포멧 형식이 있으면 무시.\r\n            searchColumns = searchColumns.filter(c => !flatMappings[`${c}.format`])\r\n            fetchIndexDocumentSourceList({columns: searchColumns, keyword})\r\n\r\n        }, 500)\r\n    }\r\n\r\n    function handleRowAdd(newData) {\r\n        return new Promise((resolve, reject) => {\r\n            const tmpBody = unflatten(newData)\r\n            let body = {}\r\n            Object.keys(tmpBody).forEach(key => body[key.replace(/___/gi, \".\")] = tmpBody[key])\r\n            delete body['ID']\r\n            dispatch(addIndexDocumentSourceAction({ index, body }))\r\n                .then(() => setTimeout(() => {\r\n                    setProcess(true)\r\n                    fetchIndexDocumentSourceList({keyword})\r\n                        .then(resolve)\r\n                }, 1000))\r\n                .catch(reject)\r\n        })\r\n    }\r\n    function handleRowUpdate(newData, oldData) {\r\n        return new Promise((resolve, reject) => {\r\n            const tmpBody = unflatten(newData)\r\n            let body = {}\r\n            Object.keys(tmpBody).forEach(key => body[key.replace(/___/gi, \".\")] = tmpBody[key])\r\n            const id = body['_hitsId']\r\n            delete body['_hitsId']\r\n            delete body['ID']\r\n            delete body['_id']\r\n            dispatch(editIndexDocumentSourceAction({ index, id, body }))\r\n                .then(() => setTimeout(() => {\r\n                    setProcess(true);\r\n                    fetchIndexDocumentSourceList({keyword})\r\n                        .then(resolve)\r\n                }, 1000))\r\n                .catch(reject)\r\n        })\r\n    }\r\n    function handleRowDelete(oldData) {\r\n        return new Promise((resolve, reject) => {\r\n            const id = unflatten(oldData)['_hitsId']\r\n            dispatch(deleteIndexDocumentSourceAction({ index, id }))\r\n                .then(() => setTimeout(() => {\r\n                    setProcess(true)\r\n                    fetchIndexDocumentSourceList({keyword})\r\n                        .then(resolve)\r\n                }, 1000))\r\n                .catch(reject)\r\n        })\r\n    }\r\n\r\n    function customSort(a, b){\r\n        if(a === \"ID\") return -1;\r\n        if(b === \"ID\") return 1;\r\n\r\n        if (a.length > b.length) return 1;\r\n        if (b.length > a.length) return -1;\r\n        return 0;\r\n    }\r\n\r\n    return (\r\n        <React.Fragment>\r\n            {/**/}\r\n            <Box style={{width: \"100%\", height: \"0px\", display: process ? \"block\" : \"none\"}}>\r\n                <Box style={{\r\n                    zIndex: \"1201\",\r\n                    width: \"100%\",\r\n                    top: \"120px\",\r\n                    height: ((((boxRef||{})[\"current\"]||{})[\"offsetHeight\"]||478) - 175) + \"px\",\r\n                    display: \"flex\",\r\n                    justifyContent: \"center\",\r\n                    alignItems: \"center\",\r\n                    backgroundColor: \"#4646465c\",\r\n                    opacity: 0.5,\r\n                    position: \"relative\"\r\n                }}>\r\n                    <CircularProgress color=\"primary\" style={{zIndex: \"1202\"}} />\r\n                </Box>\r\n            </Box>\r\n            <Box ref={boxRef}>\r\n                {\r\n                    authUser.role.index ?\r\n                        <MaterialTable\r\n                            icons={tableIcons}\r\n                            title=\"\"\r\n                            localization={{\r\n                                body: {\r\n                                    emptyDataSourceMessage: '',\r\n                                }\r\n                            }}\r\n                            columns={columns.sort((a, b) => customSort(a,b) )\r\n                                .map(column => ({\r\n                                title: column,\r\n                                field: column.replace(/\\./gi, \"___\"),\r\n                                editable: column === \"ID\" ? 'never' : \"always\",\r\n                                cellStyle:{whiteSpace: \"nowrap\", maxWidth: \"180px\", overflow: \"hidden\"},\r\n                            }))}\r\n                            data={dataList.map(data => {\r\n                                let tmpData = {}\r\n                                Object.keys(data).forEach(key => {\r\n                                    if (typeof data[key] !== 'object') {\r\n                                        tmpData[key] = data[key]\r\n                                    }\r\n                                })\r\n                                return tmpData\r\n                            })}\r\n                            onChangeRowsPerPage={handleChangeRowsPerPage}\r\n                            editable={{ onRowAdd: handleRowAdd, onRowUpdate: handleRowUpdate, onRowDelete: handleRowDelete }}\r\n                            onSearchChange={handleSearch}\r\n                            options={{\r\n                                headerStyle: {\r\n                                    maxWidth: \"180px\"\r\n                                }\r\n                            }}\r\n                            onRowClick={(event, rowData) => {\r\n                                setSelectData(event.target.innerText || \"\")\r\n                            }}\r\n                        />\r\n                        :\r\n                        <MaterialTable\r\n                            icons={tableIcons}\r\n                            title=\"\"\r\n                            localization={{\r\n                                body: {\r\n                                    emptyDataSourceMessage: '',\r\n                                }\r\n                            }}\r\n                            columns={columns.sort((a, b) => customSort(a,b) ).map(column => ({\r\n                                title: column,\r\n                                field: column.replace(/\\./gi, \"___\"),\r\n                                editable: column === \"ID\" ? 'never' : \"always\",\r\n                                cellStyle:{whiteSpace: \"nowrap\", maxWidth: \"180px\"},\r\n                            }))}\r\n                            data={dataList}\r\n                            onChangeRowsPerPage={handleChangeRowsPerPage}\r\n                            onSearchChange={handleSearch}\r\n                            options={{\r\n                                headerStyle: {\r\n                                    maxWidth: \"180px\"\r\n                                }\r\n                            }}\r\n                            onRowClick={(event, rowData) => {\r\n                                setSelectData(event.target.innerText || \"\")\r\n                            }}\r\n                        />\r\n                }\r\n            </Box>\r\n\r\n            <Card style={{display: selectData === \"\" ? \"none\" : \"block\"}}>\r\n                <CardContent>\r\n                    <Box mt={5}>\r\n                        <Typography variant=\"h5\" gutterBottom >\r\n                            {selectData}\r\n                        </Typography>\r\n                    </Box>\r\n                </CardContent>\r\n            </Card>\r\n\r\n        </React.Fragment>\r\n    )\r\n}\r\n\r\nexport default connect(store => ({...store.indicesReducers, ...store.dsearchReducers}))(DataEditTable)","import React, {useEffect, useState} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport flat from \"flat\"\r\nimport {\r\n    Box,\r\n    Button,\r\n    Card,\r\n    CardContent,\r\n    FormControl,\r\n    Grid,\r\n    IconButton,\r\n    InputBase,\r\n    MenuItem,\r\n    Select,\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableContainer,\r\n    TableHead,\r\n    TableRow,\r\n    CircularProgress\r\n} from \"@material-ui/core\";\r\nimport {Search} from \"@material-ui/icons\";\r\nimport {\r\n    analyzerDocumentSourceAction,\r\n    setIndexDocumentSourceListAction,\r\n    setIndexMappingsAction\r\n} from \"../../../redux/actions/indicesActions\";\r\n\r\nconst useStyles = makeStyles((theme) => ({}));\r\n\r\nconst rowSizeList = [5, 10, 20]\r\nconst idKey = \"* ID\"\r\nfunction IndexedDataTable({dispatch, index, mappings}) {\r\n    const classes = useStyles()\r\n    const [keyword, setKeyword] = useState(\"\");\r\n    const [keywordInput, setKeywordInput] = useState(\"\");\r\n    const [columns, setColumns] = useState([]);\r\n    const [from, setFrom] = useState(0);\r\n    const [size, setSize] = useState(5);\r\n    const [dataList, setDataList] = useState([])\r\n    const [totalSize, setTotalSize] = useState(0)\r\n    const [loading, setLoading] = useState(false)\r\n\r\n    // 인덱스 변경시 호출\r\n    useEffect(() => {\r\n        setKeyword(\"\")\r\n        setColumns([])\r\n        setFrom(0)\r\n        fetchDocuments({searchKeyword: \"\", searchFrom: 0})\r\n    }, [index]) // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n    function fetchDocuments({ searchFrom, searchSize, searchKeyword }) {\r\n        setDataList([])\r\n        setLoading(true)\r\n        dispatch(setIndexMappingsAction(index)).then(response => {\r\n            const mappings = (((response||{})['payload']||{})['properties']||{})\r\n            let flatMappings = {}\r\n            Object.keys(flat(mappings))\r\n                .forEach(key => {\r\n                    flatMappings[key.replace(/.properties/gi, \"\")] = flat(mappings)[key]\r\n                })\r\n            return { mappings, flatMappings }\r\n        }).then(payload => {\r\n\r\n            let searchColumns = []\r\n            const flatMappings = flat(mappings)\r\n            if (/[^0-9]/gi.test(searchKeyword)) {\r\n                // 문자\r\n                searchColumns = columns.filter(c => ['text','keyword'].includes(flatMappings[`${c}.type`]))\r\n            } else {\r\n                searchColumns = columns\r\n            }\r\n            // 포멧 형식이 있으면 무시.\r\n            searchColumns = searchColumns.filter(c => !flatMappings[`${c}.format`])\r\n\r\n            return dispatch(setIndexDocumentSourceListAction({\r\n                index,\r\n                from: searchFrom||from,\r\n                size: searchSize||size,\r\n                keyword: searchKeyword === undefined ? keyword : searchKeyword,\r\n                columns: searchColumns\r\n            })).then(documents => ({\r\n                ...payload,\r\n                documents: documents\r\n            }))\r\n        }).then(payload => {\r\n            const hits = ((((payload||{})['documents']||{})['hits']||{})['hits']||[])\r\n\r\n            if (searchKeyword === undefined || searchKeyword === '') {\r\n                let tmpColumns = {}\r\n                // tmpColumns['ID'] = null\r\n                hits.forEach(hit => {\r\n                    const source = flat(hit['_source'])\r\n                    Object.keys(source).forEach(key => {\r\n                        tmpColumns[key] = null\r\n                    })\r\n                })\r\n                setColumns(Object.keys(tmpColumns))\r\n            }\r\n\r\n            let documentAnalyzerMap = {}\r\n            hits.forEach(hit => {\r\n                const id = hit['_id']\r\n                const flatSource = flat(hit['_source'])\r\n\r\n                documentAnalyzerMap[id] = []\r\n                Object.keys(flatSource).forEach(flatField => {\r\n                    let analyzer = \"\"\r\n                    if(((payload||{})['flatMappings']||{})[flatField + \".type\"] === \"text\") {\r\n                        analyzer = \"standard\"\r\n                    }\r\n                    if (((payload||{})['flatMappings']||{})[flatField + \".analyzer\"]) {\r\n                        analyzer = (payload||{})['flatMappings'][flatField + \".analyzer\"]\r\n                    }\r\n\r\n                    if (analyzer && analyzer !== \"\") {\r\n                        documentAnalyzerMap[id].push({\r\n                            field: flatField, text: flatSource[flatField], analyzer: analyzer\r\n                        })\r\n                    }\r\n\r\n                    // fields 하위 필드에 대해 분석을 시도함.\r\n                    let tmpMap = {}\r\n                    Object.keys(((payload||{})['flatMappings']||{}))\r\n                        .filter(k => k.includes(`${flatField}.fields`))\r\n                        .forEach(k => {\r\n                            if (k.endsWith(\".analyzer\")) {\r\n                                // 분석기가 있는 경우.\r\n                                delete tmpMap[`${k.substring(0, k.length - 9)}.type`]\r\n                                tmpMap[k] = {\r\n                                    field: (k.substring(0, k.length - 9).replaceAll(\".fields\", \"\")),\r\n                                    text: flatSource[flatField],\r\n                                    analyzer: ((payload||{})['flatMappings']||{})[k]||\"standard\"\r\n                                }\r\n                            } else if (k.endsWith(\".type\") && !tmpMap[`${k.substring(0, k.length - 5)}.analyzer`]) {\r\n                                // 분석기 없으면 standard 선택\r\n                                tmpMap[k] = {\r\n                                    field: (k.substring(0, k.length - 5).replaceAll(\".fields\", \"\")),\r\n                                    text: flatSource[flatField],\r\n                                    analyzer: \"standard\"\r\n                                }\r\n                            }\r\n                        })\r\n                    Object.values(tmpMap).forEach(o => {\r\n                        hit['_source'][o['field']] = flatSource[flatField]\r\n                        documentAnalyzerMap[id].push(o)\r\n                    })\r\n                })\r\n            })\r\n            return {\r\n                ...payload||{},\r\n                totalSize: ((((payload||{})['documents']||{})['hits']||{})['total']||{})['value']||0,\r\n                documentAnalyzerMap: documentAnalyzerMap\r\n            }\r\n        }).then(payload => {\r\n            dispatch(analyzerDocumentSourceAction(index, (payload||{})['documentAnalyzerMap']||{})).then(response => {\r\n                let tmpDataList = [];\r\n                ((((payload||{})['documents']||{})['hits']||{})['hits']||[]).forEach(hit => {\r\n                    const source = flat(hit['_source'])\r\n                    tmpDataList.push({key: idKey, value: hit['_id'], term: \"-\"})\r\n                    Object.keys(source).forEach(key => {\r\n                        let term = \"\"\r\n                        if (response[hit['_id']] && response[hit['_id']].length > 0) {\r\n                            let analyzer = response[hit['_id']].find(obj => obj['field'] === key)\r\n                            if (analyzer && analyzer['term'] && analyzer['term'].length > 0) {\r\n                                term = analyzer['term'].join(\", \")\r\n                            }\r\n                        }\r\n                        tmpDataList.push({key: key, value: source[key], term: term})\r\n                    })\r\n                })\r\n                setLoading(false)\r\n                setDataList(tmpDataList)\r\n                setTotalSize(payload['totalSize'])\r\n            })\r\n        }).catch(error => {\r\n            setLoading(false)\r\n            // alert(\"실패.\" + error)\r\n            console.log('error', error)\r\n        })\r\n    }\r\n\r\n    function handleSizeChange(event) {\r\n        setSize(event.target.value)\r\n        fetchDocuments({searchFrom:0, searchSize: event.target.value})\r\n    }\r\n\r\n    function handlePagination(searchFrom) {\r\n        setFrom(searchFrom)\r\n        fetchDocuments({searchFrom:searchFrom})\r\n    }\r\n\r\n    function handleChangeKeyword(searchKeyword) {\r\n        setKeyword(searchKeyword)\r\n        setFrom(0)\r\n        fetchDocuments({searchFrom:0, searchKeyword: searchKeyword})\r\n    }\r\n    // 인덱스가 없으면 무시.\r\n    if (!index) return null;\r\n\r\n    return (\r\n        <>\r\n            <br/>\r\n            <Card>\r\n                <CardContent>\r\n                    <Grid container>\r\n                        <Grid item xs={4}>\r\n                            <Box className={classes.form}>\r\n                                <InputBase\r\n                                    className={classes.input}\r\n                                    placeholder=\"Search\"\r\n                                    value={keywordInput}\r\n                                    onChange={event => setKeywordInput(event.target.value)}\r\n                                    onKeyUp={event => {\r\n                                        if (event.keyCode === 13) {\r\n                                            handleChangeKeyword(keywordInput)\r\n                                        }\r\n                                    }}\r\n                                />\r\n                                <IconButton  className={classes.iconButton} onClick={() => handleChangeKeyword(keywordInput)}>\r\n                                    <Search/>\r\n                                </IconButton>\r\n                            </Box>\r\n                        </Grid>\r\n                        <Grid item xs={4}>\r\n                            <Box align={\"center\"}>\r\n                                <Button variant={\"outlined\"}\r\n                                        onClick={() => handlePagination(from - size)}\r\n                                        disabled={from <= 0}\r\n                                >\r\n                                    이전\r\n                                </Button>\r\n                                <Box component={\"span\"} m={3}>\r\n                                    {\r\n                                        dataList.length > 0 ?\r\n                                            isNaN((from / size) + 1) ? 0 : (from / size) + 1\r\n                                            :\r\n                                            0\r\n                                    }\r\n                                    /\r\n                                    {isNaN(Math.ceil(totalSize / size)) ? 0 : Math.ceil(totalSize / size)}\r\n                                </Box>\r\n                                <Button variant={\"outlined\"}\r\n                                        onClick={() => handlePagination(from + size)}\r\n                                        disabled={\r\n                                            (isNaN((from / size) + 1) ? 0 : (from / size) + 1)\r\n                                            >=\r\n                                            (isNaN(Math.ceil(totalSize / size)) ? 0 : Math.ceil(totalSize / size))\r\n                                        }\r\n                                >\r\n                                    다음\r\n                                </Button>\r\n                            </Box>\r\n                        </Grid>\r\n                        <Grid item xs={4}>\r\n                            <Box align={\"right\"}>\r\n                                <FormControl className={classes.formControl}>\r\n                                    <Select\r\n                                        labelId=\"demo-simple-select-label\"\r\n                                        id=\"demo-simple-select\"\r\n                                        value={size}\r\n                                        onChange={handleSizeChange}\r\n                                    >\r\n                                        {\r\n                                            rowSizeList.map(num => <MenuItem key={num} value={num}>{num}</MenuItem>)\r\n                                        }\r\n                                    </Select>\r\n                                </FormControl>\r\n                            </Box>\r\n                        </Grid>\r\n                    </Grid>\r\n\r\n                    <TableContainer>\r\n                        <Table size={\"small\"}>\r\n                            <colgroup>\r\n                                <col style={{width:'20%'}}/>\r\n                                <col style={{width:'40%'}}/>\r\n                                <col style={{width:'40%'}}/>\r\n                            </colgroup>\r\n                            <TableHead>\r\n                                <TableRow>\r\n                                    <TableCell>아이디</TableCell>\r\n                                    <TableCell>값</TableCell>\r\n                                    <TableCell>분석결과</TableCell>\r\n                                </TableRow>\r\n                            </TableHead>\r\n                            <TableBody style={{display: loading ? \"table-row-group\" : \"none\"}}>\r\n                                <TableRow>\r\n                                    <TableCell colSpan={3}>\r\n                                        <Box align={\"center\"}>\r\n                                            <CircularProgress />\r\n                                        </Box>\r\n                                    </TableCell>\r\n                                </TableRow>\r\n                            </TableBody>\r\n                            <TableBody style={{display: loading ? \"none\" : \"table-row-group\"}}>\r\n                                {\r\n                                    dataList.map((data, dataIndex) => {\r\n                                        try {\r\n                                            return (\r\n                                                <TableRow key={`${data['key']}-${dataIndex}`}>\r\n                                                    <TableCell>\r\n                                                        {data['key']}\r\n                                                    </TableCell>\r\n                                                    <TableCell>\r\n                                                        {data['value']}\r\n                                                    </TableCell>\r\n                                                    <TableCell>\r\n                                                        {data['term']}\r\n                                                    </TableCell>\r\n                                                </TableRow>\r\n                                            )\r\n                                        } catch (err) {\r\n                                            console.error(err)\r\n                                            return false\r\n                                        }\r\n                                    })\r\n                                }\r\n                            </TableBody>\r\n                        </Table>\r\n                    </TableContainer>\r\n\r\n                    <br/>\r\n\r\n                    <Grid container>\r\n                        <Grid item xs={12}>\r\n                            <Box align={\"center\"}>\r\n                                <Button variant={\"outlined\"}\r\n                                        onClick={() => handlePagination(from - size)}\r\n                                        disabled={from <= 0}\r\n                                >\r\n                                    이전\r\n                                </Button>\r\n                                <Box component={\"span\"} m={3}>\r\n                                    {\r\n                                        dataList.length > 0 ?\r\n                                            isNaN((from / size) + 1) ? 0 : (from / size) + 1\r\n                                            :\r\n                                            0\r\n                                    }\r\n                                    /\r\n                                    {isNaN(Math.ceil(totalSize / size)) ? 0 : Math.ceil(totalSize / size)}\r\n                                </Box>\r\n                                <Button variant={\"outlined\"}\r\n                                        onClick={() => handlePagination(from + size)}\r\n                                        disabled={\r\n                                            (isNaN((from / size) + 1) ? 0 : (from / size) + 1)\r\n                                            >=\r\n                                            (isNaN(Math.ceil(totalSize / size)) ? 0 : Math.ceil(totalSize / size))\r\n                                        }\r\n                                >\r\n                                    다음\r\n                                </Button>\r\n                            </Box>\r\n                        </Grid>\r\n                    </Grid>\r\n                </CardContent>\r\n            </Card>\r\n        </>\r\n    )\r\n}\r\n\r\n\r\nexport default connect(store => ({...store.indicesReducers}))(IndexedDataTable)","import React, {useState} from \"react\";\r\nimport {Box, FormControl, FormControlLabel, Radio, RadioGroup} from \"@material-ui/core\";\r\nimport DataEditTable from \"./DataEditTable\";\r\nimport IndexedDataTable from \"./IndexedDataTable\";\r\n\r\nfunction Data() {\r\n    const [chk, setChk] = useState('source'); // source, indexed\r\n\r\n    function handleRadioChange(e) {\r\n        setChk(e.target.value)\r\n    }\r\n\r\n    return (\r\n        <React.Fragment>\r\n\r\n            <FormControl component=\"fieldset\">\r\n                <RadioGroup row aria-label=\"position\" name=\"position\" defaultValue=\"top\">\r\n                    <FormControlLabel value=\"source\" checked={chk === \"source\"} onChange={handleRadioChange}\r\n                                      control={<Radio color=\"primary\"/>} label=\"기본\"/>\r\n                    <FormControlLabel value=\"indexed\" checked={chk === \"indexed\"} onChange={handleRadioChange}\r\n                                      control={<Radio color=\"primary\"/>} label=\"분석된 색인어\"/>\r\n                </RadioGroup>\r\n            </FormControl>\r\n\r\n            <Box mt={2}>\r\n                {\r\n                    chk === \"source\" ? <DataEditTable/> : <IndexedDataTable />\r\n                }\r\n            </Box>\r\n        </React.Fragment>\r\n    );\r\n}\r\n\r\nexport default Data"],"sourceRoot":""}